---
layout: post
title: Configuration handler issue
date: 2006-12-07 14:51:48.000000000 -05:00
categories: []
tags:
- ".NET"
status: publish
type: post
published: true
meta:
  pvc_views: '874'
  dsq_thread_id: '377618187'
author:
  login: kyle6994
  email: kyle@baley.org
  display_name: Kyle Baley
  first_name: ''
  last_name: ''
excerpt: !ruby/object:Hpricot::Doc
  options: {}
---
<p>So I boot up my laptop and start pounding away at my Windows app, making changes that will add so much value that it's dripping from my screen (waitaminute...that's not value...EWWWW!). It should be noted that I'm the sole proprietor of this application on the basis that I'm the sole .NET developer on the team.</p>
<p>Hit F5 to let 'er rip and BAM! at the section that loads my custom config section from app.config, code I wrote almost by rote several weeks ago and which I've promptly forgotten because I haven't touched it since.</p>
<p>My custom config is pretty straightforward. Here's the app.config:</p>
<p><font color="#0000ff" size="2">&lt;</font><font color="#800000" size="2">configSections</font><font color="#0000ff" size="2">&gt;<br />&nbsp;&nbsp;&nbsp;</font><font color="#0000ff" size="2">&lt;</font><font color="#800000" size="2">section</font><font color="#ff00ff" size="2"> </font><font color="#ff0000" size="2">name</font><font color="#0000ff" size="2">="Handlers"</font><font color="#ff00ff" size="2">&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff0000" size="2">type</font><font color="#0000ff" size="2">="CodingHillbilly.SkinningManager.Windows.Configuration.MyConfigurationHandler, CodingHillbilly.SkinningManager.Windows"</font><font color="#ff00ff" size="2"> </font><font color="#0000ff" size="2">/&gt;<br /></font><font size="2"></font><font color="#0000ff" size="2">&lt;/</font><font color="#800000" size="2">configSections</font><font color="#0000ff" size="2">&gt;</p>
<p></font><font color="#0000ff" size="2">&lt;</font><font color="#800000" size="2">Handlers</font><font color="#0000ff" size="2">&gt;<br />&nbsp;&nbsp;&nbsp;</font><font color="#0000ff" size="2">&lt;</font><font color="#800000" size="2">Handler</font><font color="#ff00ff" size="2"> </font><font color="#ff0000" size="2">name</font><font color="#0000ff" size="2">="Raccoon"</font><font color="#ff00ff" size="2">&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff0000" size="2">assemblyName</font><font color="#0000ff" size="2">="CodingHillbilly.Handlers.Raccoon"&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff0000" size="2">className</font><font color="#0000ff" size="2">="CodingHillbilly.Handlers.Raccoon.RaccoonHandler"</font><font color="#0000ff" size="2">&gt;<br />&nbsp;&nbsp;&nbsp;</font><font color="#0000ff" size="2">&lt;/</font><font color="#800000" size="2">Handler</font><font color="#0000ff" size="2">&gt;<br /></font><font color="#0000ff" size="2">&nbsp;&nbsp;&nbsp;<font color="#0000ff" size="2">&lt;</font><font color="#800000" size="2">Handler</font><font color="#ff00ff" size="2"> </font><font color="#ff0000" size="2">name</font><font color="#0000ff" size="2">="Squirrel"</font><font color="#ff00ff" size="2">&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff0000" size="2">assemblyName</font><font color="#0000ff" size="2">="CodingHillbilly.Handlers.Squirrel"&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff0000" size="2">className</font><font color="#0000ff" size="2">="CodingHillbilly.Handlers.Squirrel.SquirrelHandler"</font><font color="#0000ff" size="2">&gt;<br />&nbsp;&nbsp;&nbsp;</font><font color="#0000ff" size="2">&lt;/</font><font color="#800000" size="2">Handler</font><font color="#0000ff" size="2">&gt;<br /></font>&nbsp;&nbsp;&nbsp;<font color="#0000ff" size="2">&lt;</font><font color="#800000" size="2">Handler</font><font color="#ff00ff" size="2"> </font><font color="#ff0000" size="2">name</font><font color="#0000ff" size="2">="Possum"</font><font color="#ff00ff" size="2">&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff0000" size="2">assemblyName</font><font color="#0000ff" size="2">="CodingHillbilly.Handlers.Possum"&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff0000" size="2">className</font><font color="#0000ff" size="2">="CodingHillbilly.Handlers.Possum.PossumHandler"</font><font color="#0000ff" size="2">&gt;<br />&nbsp;&nbsp;&nbsp;</font><font color="#0000ff" size="2">&lt;/</font><font color="#800000" size="2">Handler</font><font color="#0000ff" size="2">&gt;<br /></font>&lt;/</font><font color="#800000" size="2">Handlers</font><font color="#0000ff" size="2">&gt;</font></p>
<p>In the ConfigurationHandler, I create an object for each handler, gather them up in a Hashtable and return it:</p>
<p><span style="FONT-SIZE: 11px; COLOR: black; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent"><span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">public</span> <span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">class</span> MyConfigurationHandler : IConfigurationSectionHandler<br />{<br /><span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">&nbsp;&nbsp;&nbsp;public</span> <span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">object</span> Create( <span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">object</span> parent, <span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">object</span> configContext, XmlNode section )<br />&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hashtable skinninHandlers <span style="FONT-SIZE: 11px; COLOR: red; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">=</span> <span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">new</span> Hashtable( );</p>
<p><span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach</span> ( XmlNode handler <span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">in</span> section.ChildNodes )<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</p>
<p><span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if</span> ( handler.NodeType !<span style="FONT-SIZE: 11px; COLOR: red; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">=</span> XmlNodeType.CDATA &amp;&amp; handler.NodeType !<span style="FONT-SIZE: 11px; COLOR: red; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">=</span> XmlNodeType.Whitespace )<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br /><span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string</span> displayName <span style="FONT-SIZE: 11px; COLOR: red; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">=</span> handler.Attributes[<span style="FONT-SIZE: 11px; COLOR: #666666; FONT-FAMILY: Courier New; BACKGROUND-COLOR: #e4e4e4">"name"</span>].Value;<br /><span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string</span> assemblyName <span style="FONT-SIZE: 11px; COLOR: red; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">=</span> handler.Attributes[<span style="FONT-SIZE: 11px; COLOR: #666666; FONT-FAMILY: Courier New; BACKGROUND-COLOR: #e4e4e4">"assemblyName"</span>].Value;<br /><span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string</span> className <span style="FONT-SIZE: 11px; COLOR: red; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">=</span> handler.Attributes[<span style="FONT-SIZE: 11px; COLOR: #666666; FONT-FAMILY: Courier New; BACKGROUND-COLOR: #e4e4e4">"className"</span>].Value;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyHandlerObject handlerConfig <span style="FONT-SIZE: 11px; COLOR: red; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">=</span> <span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">new</span> MyHandlerObject( displayName, assemblyName, className );</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;skinninHandlers.Add( displayName, handlerConfig );<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p><span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return</span> skinninHandlers;<br />&nbsp;&nbsp;&nbsp;}<br />}<br /></span></p>
<p>And in the main code:</p>
<p><span style="FONT-SIZE: 11px; COLOR: black; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">handlers <span style="FONT-SIZE: 11px; COLOR: red; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">=</span> (Hashtable) ConfigurationSettings.GetConfig( <span style="FONT-SIZE: 11px; COLOR: #666666; FONT-FAMILY: Courier New; BACKGROUND-COLOR: #e4e4e4">"Handlers"</span> );<br /><span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">foreach</span> ( MyHandlerObject handler <span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">in</span> handlers.Values )<br />{<br /><span style="FONT-SIZE: 11px; COLOR: blue; FONT-FAMILY: Courier New; BACKGROUND-COLOR: transparent">&nbsp;&nbsp;&nbsp;this</span>.comboBoxHandlers.Items.Add( handler.Name );<br />}</span></p>
<p>Like I said, I wrote this long ago in a different time and for whatever reason, it starts complaining this morning. Whining that it can't cast the objects in handlers.Values to a MyHandlerObject anymore. But when I debug, every object in handlers.Values is, in fact, a CodingHillbilly.SkinningManager.Configuration.MyHandlerObject object.</p>
<p>The key was in the type attribute of the Handlers section. Yesterday, I handed off my work in progress to someone to start testing and in a fit of user-friendliness, I didn't want the executable to be named CodingHillbilly.SkinningManager.Windows.exe, so I changed the name of the assembly in the project properties to UltimateSkinner.exe.</p>
<p>Hence, it was creating handlers based on the old assembly and trying to cast them to handlers from the new assembly because the Debug folder still actually contained the old CodingHillbilly.SkinningManager.Windows.exe. I suspected there was some reference issue so I cleared the Debug folder completely, re-compiled and lo! Now it can't find a reference to the assembly to even create the config handler.</p>
<p>From there it was a quick fix to the &lt;section&gt; to reference the correct assembly:</p>
<p><font color="#0000ff">&nbsp;&nbsp;&nbsp;<font size="2">&lt;</font></font><font color="#800000" size="2">section</font><font color="#ff00ff" size="2"> </font><font color="#ff0000" size="2">name</font><font color="#0000ff" size="2">="Handlers"</font><font color="#ff00ff" size="2">&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff0000" size="2">type</font><font color="#0000ff" size="2">="CodingHillbilly.SkinningManager.Windows.Configuration.MyConfigurationHandler, UltimateSkinner"</font><font color="#ff00ff" size="2"> </font><font color="#0000ff" size="2">/&gt;</font></p>
<p>So the moral of the story is: don't do anything to make the user's life easier.</p>
<p>moo</p>
